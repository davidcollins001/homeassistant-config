# https://www.home-assistant.io/integrations/braviatv/

# switch to netflix or youtube
  - alias: netflix_youtube
    mode: restart
    trigger:
      - platform: state
        entity_id:
          - input_boolean.netflix
          - input_boolean.youtube
        from: "off"
        to: "on"
    action:
      - choose:
        # switch tv on if it's not already on
        - conditions: "{{ states('media_player.sony_bravia_tv') == 'off' }}"
          sequence:
            - service: media_player.turn_on
              target:
                entity_id: media_player.sony_bravia_tv
            - delay:
                seconds: 7
      - service: media_player.select_source
        target:
          entity_id: media_player.sony_bravia_tv
        data:
            source: >
              {% if trigger.entity_id == 'input_boolean.netflix' %}
                Netflix
              {% elif trigger.entity_id == 'input_boolean.youtube' %}
                YouTube
              {% endif %}
      - choose:
        # wait and select user profile for netflix
        - conditions: "{{ trigger.entity_id == 'input_boolean.netflix' }}"
          sequence:
          - delay:
              seconds: 15
          - service: remote.send_command
            target:
              entity_id: remote.sony_bravia_tv
            data:
              command: Confirm
      - service: input_boolean.turn_off
        target:
          entity_id: "{{ trigger.entity_id }}"

# press button needed to recover from a youtube crash
  - alias: fix_youtube
    trigger:
      - platform: state
        entity_id:
          - input_boolean.fix_youtube
        from: "off"
        to: "on"
    action:
      - service: remote.send_command
        target:
          entity_id: remote.sony_bravia_tv
        data:
          command: Return
      - delay:
          seconds: 1
      - service: remote.send_command
        target:
          entity_id: remote.sony_bravia_tv
        data:
          command: Confirm
      - delay:
          seconds: 20
      - service: remote.send_command
        target:
          entity_id: remote.sony_bravia_tv
        data:
          command: Confirm
      - delay:
          seconds: 1
      - service: remote.send_command
        target:
          entity_id: remote.sony_bravia_tv
        data:
          command: Confirm
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.fix_youtube
